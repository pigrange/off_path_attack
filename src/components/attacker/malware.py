# @coding: utf-8
# @Author：john pig
# @Date ：10/11/2019 5:07 PM
# @Tool ：PyCharm
from abc import ABCMeta, abstractmethod

# 抽象类，定义可被恶意软件感染的目标
from src.components.end_host.system_service.network.network_listener import NetWorkListener


class Parasitic:
    __metaclass__ = ABCMeta

    @abstractmethod
    def on_infect(self):
        pass


class __Malware(NetWorkListener):

    def on_package_received(self):
        if self.shell is not None:
            shell = self.shell
            net_state = shell.query_net_state()
        # todo 向恶意服务器通知
        pass

    # victim以为建立了连接,广播已建立链接
    def on_establish_connection(self, origin, target):
        # todo 向恶意服务器通知
        pass

    def __init__(self):
        self.shell = None
        self.victim = None
        pass

    def infect_victim(self, victim):
        self.victim = victim
        shell = self.victim.on_infect()
        shell.register_network_listener(self)
        return shell


__malware = __Malware()


def infect(victim: Parasitic):
    __malware.infect_victim(victim)
    pass
